<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lexington Hydrants</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      html, body { height: 100%; margin: 0; }
      #map { height: 100%; width: 100%; }
    </style>
  </head>

  <body>
    <div id="map"></div>

    <script>
      // 1) Map + basemap
      const map = L.map("map").setView([42.447, -71.225], 13);

      L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      // 2) Custom hydrant icon
      const hydrantIcon = L.icon({
        iconUrl: "fire_hydrant_64x64.png",
        iconSize: [32, 32],
        iconAnchor: [16, 16],
        popupAnchor: [0, -16]
      });

      // 3) Load GeoJSON and add to map
      fetch("hydrants.geojson")
        .then(r => r.json())
        .then(data => {
          const layer = L.geoJSON(data, {
            pointToLayer: (feature, latlng) => L.marker(latlng, { icon: hydrantIcon }),
            onEachFeature: (feature, lyr) => {
              const p = feature.properties || {};
              // Simple popup: render key fields; extend as you like
              const html = `
                <div style="font-family: system-ui, sans-serif; font-size: 14px; line-height: 1.35;">
                  <div><b>${p.facilityid ?? p.legacy_id ?? "Hydrant"}</b></div>
                  ${p.locdesc ? `<div><b>Location:</b> ${p.locdesc}</div>` : ""}
                  ${p.condition ? `<div><b>Condition:</b> ${p.condition}</div>` : ""}
                  ${p.flow ? `<div><b>Flow (GPM):</b> ${p.flow}</div>` : ""}
                  ${p.manufactur ? `<div><b>Manufacturer:</b> ${p.manufactur}</div>` : ""}
                  ${p.model_no ? `<div><b>Model:</b> ${p.model_no}</div>` : ""}
                  ${p.color ? `<div><b>Color:</b> ${p.color}</div>` : ""}
                  ${p.installdat ? `<div><b>Installed:</b> ${p.installdat}</div>` : ""}
                </div>
              `;
              lyr.bindPopup(html);
            }
          }).addTo(map);

          map.fitBounds(layer.getBounds(), { padding: [20, 20] });
        })
        .catch(err => {
          console.error(err);
          alert("Failed to load hydrants.geojson. Check file name/path.");
        });
    </script>
  </body>
</html>
